# FixMatch

**FixMatch** æ˜¯ä¸€ä¸ªéå®˜æ–¹çš„ **PyTorch** å®ç°ï¼ŒåŸºäºè®ºæ–‡ [*Simplifying Semi-Supervised Learning with Consistency and Confidence*](https://arxiv.org/abs/2001.07685)ã€‚

å®˜æ–¹ **TensorFlow** å®ç°ï¼š[GitHub](https://github.com/google-research/fixmatch)

æœ¬ä»£ç ä»…æ”¯æŒ **FixMatchï¼ˆRandAugmentï¼‰**ã€‚

---

## ğŸš€ ç»“æœ

### ğŸ“Œ CIFAR-10

| æ ‡ç­¾æ•° | 40 | 250 | 4000 |
|--------|----|-----|------|
| è®ºæ–‡ï¼ˆRAï¼‰ | 86.19 Â± 3.37 | 94.93 Â± 0.65 | 95.74 Â± 0.05 |
| æœ¬ä»£ç  | **93.60** | **95.31** | **95.77** |
| ğŸ”— å‡†ç¡®ç‡æ›²çº¿ | [é“¾æ¥](#) | [é“¾æ¥](#) | [é“¾æ¥](#) |

> **2020 å¹´ 11 æœˆ**ï¼šä¿®å¤ EMA é—®é¢˜åé‡æ–°æµ‹è¯•ã€‚

### ğŸ“Œ CIFAR-100

| æ ‡ç­¾æ•° | 400 | 2500 | 10000 |
|--------|----|------|-------|
| è®ºæ–‡ï¼ˆRAï¼‰ | 51.15 Â± 1.75 | 71.71 Â± 0.11 | 77.40 Â± 0.12 |
| æœ¬ä»£ç  | **57.50** | **72.93** | **78.12** |
| ğŸ”— å‡†ç¡®ç‡æ›²çº¿ | [é“¾æ¥](#) | [é“¾æ¥](#) | [é“¾æ¥](#) |

> **è®­ç»ƒæ—¶ä½¿ç”¨çš„é¢å¤–å‚æ•°**ï¼š`--amp --opt_level O2 --wdecay 0.001`

---

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### ğŸ‹ï¸ è®­ç»ƒ

#### âœ… åœ¨ CIFAR-10ï¼ˆ4000 æ¡æ ‡æ³¨æ•°æ®ï¼‰ä¸Šè®­ç»ƒæ¨¡å‹
tree
./data/
  â”œâ”€â”€ labeled/
  â”‚   â”œâ”€â”€ class1/
  â”‚   â”‚   â”œâ”€â”€ image1.jpeg
  â”‚   â”‚   â”œâ”€â”€ image2.jpeg
  â”‚   â”‚   â””â”€â”€ ...
  â”‚   â”œâ”€â”€ class2/
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ unlabeled/
  â”‚   â”œâ”€â”€ image1.jpeg
  â”‚   â”œâ”€â”€ image2.jpeg
  â”‚   â””â”€â”€ ...
  â””â”€â”€ test/
      â”œâ”€â”€ class1/
      â”œâ”€â”€ class2/
      â””â”€â”€ ...
```
python train.py --dataset mstar --num-labeled 4000 --arch wideresnet --batch-size 64 --lr 0.03 --expand-labels --seed 5 --out results/mstar
```
```
python train.py --dataset cifar10 --num-labeled 4000 --arch wideresnet --batch-size 64 --lr 0.03 --expand-labels --seed 5 --out results/cifar10@4000.5
```

test
```commandline
python train.py --dataset mstar --num-labeled 4000 --out ./results/mstar
```
```
python train.py --dataset cifar10 --num-labeled 10 --arch wideresnet --batch-size 2 --lr 0.03 --expand-labels --seed 5 --out results/cifar10@4000.5
```

#### âœ… åœ¨ CIFAR-100ï¼ˆ10000 æ¡æ ‡æ³¨æ•°æ®ï¼‰ä¸Šè®­ç»ƒæ¨¡å‹ï¼ˆä½¿ç”¨ DistributedDataParallelï¼‰

```
python -m torch.distributed.launch --nproc_per_node 4 ./train.py --dataset cifar100 --num-labeled 10000 --arch wideresnet --batch-size 16 --lr 0.03 --wdecay 0.001 --expand-labels --seed 5 --out results/cifar100@10000
```
å‚æ•°è¯´æ˜
python -m torch.distributed.launch
è¯¥å‘½ä»¤ç”¨äºå¯åŠ¨ PyTorch çš„åˆ†å¸ƒå¼è®­ç»ƒã€‚åœ¨æ­¤å‘½ä»¤ä¸­ï¼Œtorch.distributed.launch æ¨¡å—ä¼šå¯åŠ¨å¤šè¿›ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚é€‚ç”¨äºåœ¨å¤š GPU ç¯å¢ƒä¸‹è¿›è¡Œè®­ç»ƒã€‚æ­¤å‚æ•°å¯ä»¥ä½¿è®­ç»ƒè¿‡ç¨‹æ›´åŠ é«˜æ•ˆï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨å¤šä¸ª GPU æ—¶ã€‚

--nproc_per_node 4
è¿™ä¸ªå‚æ•°è®¾ç½®äº†æ¯ä¸ªèŠ‚ç‚¹ï¼ˆé€šå¸¸æ˜¯æ¯å°æœºå™¨ï¼‰ä½¿ç”¨çš„ GPU æ•°é‡ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè®¾ç½®ä¸º 4ï¼Œæ„å‘³ç€åœ¨æ¯å°æœºå™¨ä¸Šä½¿ç”¨ 4 ä¸ª GPU è¿›è¡Œè®­ç»ƒã€‚å¦‚æœä½ æœ‰æ›´å¤šçš„ GPUï¼Œå¯ä»¥å¢åŠ æ­¤å‚æ•°çš„å€¼æ¥å……åˆ†åˆ©ç”¨èµ„æºè¿›è¡Œå¹¶è¡Œè®­ç»ƒã€‚

./train.py
æŒ‡å®šè®­ç»ƒè„šæœ¬çš„è·¯å¾„ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè®­ç»ƒè„šæœ¬ train.py ä½äºå½“å‰ç›®å½•ä¸‹ã€‚è¯¥è„šæœ¬è´Ÿè´£åŠ è½½æ•°æ®é›†ã€æ„å»ºæ¨¡å‹ã€é…ç½®ä¼˜åŒ–å™¨ï¼Œå¹¶è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚

--dataset cifar100
è¯¥å‚æ•°æŒ‡å®šäº†è¦ä½¿ç”¨çš„æ•°æ®é›†ç±»å‹ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ CIFAR-100 æ•°æ®é›†ã€‚CIFAR-100 æ˜¯ä¸€ä¸ªåŒ…å« 100 ç±»ç‰©ä½“å›¾åƒçš„å°å‹å›¾åƒæ•°æ®é›†ï¼Œé€šå¸¸ç”¨äºå›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚è¯¥æ•°æ®é›†åŒ…å« 60,000 å¼  32x32 åƒç´ çš„å½©è‰²å›¾åƒã€‚

--num-labeled 10000
æŒ‡å®šè®­ç»ƒæ—¶ä½¿ç”¨çš„æ ‡æ³¨æ ·æœ¬æ•°é‡ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† 10,000 ä¸ªæ ‡æ³¨æ ·æœ¬è¿›è¡Œè®­ç»ƒã€‚åœ¨åŠç›‘ç£å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åªæ ‡æ³¨æ•°æ®é›†çš„ä¸€éƒ¨åˆ†ï¼Œå‰©ä½™æ•°æ®ç”¨ä¼ªæ ‡ç­¾è¿›è¡Œè®­ç»ƒã€‚

--arch wideresnet
è¯¥å‚æ•°æŒ‡å®šäº†ä½¿ç”¨çš„æ¨¡å‹æ¶æ„ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† WideResNet ç½‘ç»œæ¶æ„ã€‚WideResNet æ˜¯ä¸€ç§å…·æœ‰è¾ƒå®½çš„å·ç§¯å±‚çš„ç½‘ç»œæ¶æ„ï¼Œé€šå¸¸æ¯”æ™®é€šçš„ ResNet æ›´å¿«ä¸”å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚é€‚ç”¨äºå¤§è§„æ¨¡å›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚

--batch-size 16
è®¾ç½®è®­ç»ƒçš„æ‰¹æ¬¡å¤§å°ï¼Œå³æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä¸­å¤„ç†çš„æ ·æœ¬æ•°ã€‚æ­¤å‚æ•°æ§åˆ¶æ¯æ¬¡è¿­ä»£æ—¶çš„å†…å­˜ä½¿ç”¨é‡å’Œè®­ç»ƒçš„æ•ˆç‡ã€‚è¾ƒå°çš„æ‰¹æ¬¡å¤§å°èƒ½å¤Ÿå‡å°‘æ˜¾å­˜çš„å ç”¨ï¼Œä½†å¯èƒ½ä¼šå¢åŠ è®­ç»ƒæ—¶é—´ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‰¹æ¬¡å¤§å°è®¾ç½®ä¸º 16ã€‚

--lr 0.03
è¯¥å‚æ•°è®¾ç½®å­¦ä¹ ç‡ï¼ˆlearning rateï¼‰ã€‚å­¦ä¹ ç‡æ§åˆ¶ä¼˜åŒ–å™¨æ›´æ–°æ¨¡å‹å‚æ•°çš„æ­¥é•¿ã€‚è¾ƒå°çš„å­¦ä¹ ç‡å¯èƒ½å¯¼è‡´è®­ç»ƒè¿‡ç¨‹ç¼“æ…¢ï¼Œè€Œè¾ƒå¤§çš„å­¦ä¹ ç‡å¯èƒ½ä½¿æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éœ‡è¡ï¼Œå¯¼è‡´éš¾ä»¥æ”¶æ•›ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå­¦ä¹ ç‡è®¾ç½®ä¸º 0.03ã€‚

--wdecay 0.001
æƒé‡è¡°å‡ï¼ˆweight decayï¼‰ï¼Œé€šå¸¸ç”¨äºæ­£åˆ™åŒ–ï¼Œä»¥é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆã€‚é€šè¿‡å¯¹æ¨¡å‹å‚æ•°æ–½åŠ æƒ©ç½šï¼Œæƒé‡è¡°å‡èƒ½æœ‰æ•ˆåœ°é˜²æ­¢æ¨¡å‹çš„å¤æ‚åº¦è¿‡é«˜ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè®¾ç½®ä¸º 0.001ï¼Œè¡¨ç¤ºå¯¹æƒé‡è¿›è¡Œè½»å¾®çš„æ­£åˆ™åŒ–ã€‚

--expand-labels
è¯¥é€‰é¡¹å¯ç”¨æ ‡ç­¾æ‰©å±•åŠŸèƒ½ã€‚åœ¨åŠç›‘ç£å­¦ä¹ ä¸­ï¼Œé€šå¸¸ä¼šé€šè¿‡æŸç§æ–¹æ³•ï¼ˆå¦‚ä¼ªæ ‡ç­¾ï¼‰æ‰©å±•æ•°æ®é›†ä¸­çš„æ ‡ç­¾ï¼Œä»¥åˆ©ç”¨æœªæ ‡æ³¨çš„æ•°æ®è¿›è¡Œè®­ç»ƒã€‚å¯ç”¨æ­¤é€‰é¡¹åï¼Œæ¨¡å‹ä¼šå°è¯•ç”Ÿæˆæœªæ ‡æ³¨æ•°æ®çš„ä¼ªæ ‡ç­¾ï¼Œå¹¶å°†å…¶ç”¨äºè®­ç»ƒã€‚

--seed 5
è®¾ç½®éšæœºç§å­ï¼Œä»¥ç¡®ä¿è®­ç»ƒçš„å¯é‡ç°æ€§ã€‚è®¾ç½®ç›¸åŒçš„ç§å­å€¼å¯ä»¥ä¿è¯æ¯æ¬¡è®­ç»ƒçš„åˆå§‹åŒ–å‚æ•°å’Œæ•°æ®å¤„ç†é¡ºåºç›¸åŒï¼Œä»è€Œä¿è¯è®­ç»ƒç»“æœçš„ä¸€è‡´æ€§ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç§å­å€¼è®¾ç½®ä¸º 5ã€‚

--out results/cifar100@10000
è¯¥å‚æ•°æŒ‡å®šè®­ç»ƒç»“æœçš„è¾“å‡ºç›®å½•ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè®­ç»ƒç»“æœå°†ä¿å­˜åˆ° results/cifar100@10000 ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬è®­ç»ƒæ—¥å¿—ã€æ¨¡å‹æ£€æŸ¥ç‚¹ä»¥åŠå…¶ä»–ç›¸å…³æ–‡ä»¶ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹è¾“å‡ºè·¯å¾„ä»¥ä¿å­˜åˆ°ä¸åŒä½ç½®ã€‚



### ğŸ“Š ç›‘æ§è®­ç»ƒè¿›åº¦

ä½¿ç”¨ TensorBoard å¯è§†åŒ–è®­ç»ƒæ—¥å¿—ï¼š
åœ¨ TensorBoard ä¸­ï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š
Scalars é€‰é¡¹å¡ï¼šæŸ¥çœ‹ train/lossã€train/accuracyã€test/loss å’Œ test/accuracy çš„æ›²çº¿ã€‚
Graphs é€‰é¡¹å¡ï¼šå¦‚æœè®°å½•äº†æ¨¡å‹ç»“æ„ï¼Œå¯ä»¥æŸ¥çœ‹è®¡ç®—å›¾ã€‚
Histograms é€‰é¡¹å¡ï¼šå¦‚æœè®°å½•äº†æƒé‡æˆ–æ¢¯åº¦åˆ†å¸ƒï¼Œå¯ä»¥æŸ¥çœ‹ç›´æ–¹å›¾ã€‚

tensorboard --logdir=<your_out_dir>

```bash
tensorboard --logdir=results/cifar10@4000.5
```

---

## ğŸ“Œ ä¾èµ–ç¯å¢ƒ
- Python 3.6+
- PyTorch 1.4
- torchvision 0.5
- tensorboard
- numpy
- tqdm
- apexï¼ˆå¯é€‰ï¼‰

---

## ğŸ”— ç›¸å…³å®ç°
- [Meta Pseudo Labels](https://github.com/kekmodel/Meta-Pseudo-Labels)
- [UDA for images](https://github.com/kekmodel/UDA-pytorch)

---

## ğŸ“š å‚è€ƒèµ„æ–™
- **FixMatch å®˜æ–¹ TensorFlow å®ç°**ï¼š[GitHub](https://github.com/google-research/fixmatch)
- **MixMatch éå®˜æ–¹ PyTorch å®ç°**
- **RandAugment éå®˜æ–¹ PyTorch å¤ç°**
- **PyTorch å›¾åƒæ¨¡å‹**

---

## ğŸ“œ å¼•ç”¨
```bibtex
@misc{jd2020fixmatch,
  author = {Jungdae Kim},
  title = {PyTorch implementation of FixMatch},
  year = {2020},
  publisher = {GitHub},
  journal = {GitHub repository},
  howpublished = {\url{https://github.com/kekmodel/FixMatch-pytorch}}
}
